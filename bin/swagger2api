#!/usr/bin/env node
'use strict';

var program = require('commander');
var command = require('../lib/commands/generateApi/generateApi.js');
var deploy = require('../lib/commands/deployApi/deployApi.js');
var version = require('../lib/util/cli').version();


program
  .version(version);

program
  .command('generateApi <apiProxy>')
  .option('-l, --location <location>', 'Swagger File Location.')
  .option('-d, --destination <destination>', 'API Bundle destination location.')
  .option('-D, --deploy', 'Deploy to Apigee Edge')
  .description('Generate Apigee API Bundle')
  .action(function(apiProxy, options) {
    command.generateApi(apiProxy, options, function(err, reply) {
      if(err) {
        console.log(err);
      }
      if (options.destination) {
        console.log('Apigee API bundle generated in location ' + options.destination);
      } else {
        console.log('Apigee API bundle generated in current directory. ');
      }
      if (options.deploy) {
        deploy.deployApi(apiProxy, options, function(err, reply) {
          if (err) {
            console.log(err);
          }
          else {
            console.log('Deployment to Apigee successfully completed.');
          }
        });
      }
    });
  });

program.parse(process.argv);